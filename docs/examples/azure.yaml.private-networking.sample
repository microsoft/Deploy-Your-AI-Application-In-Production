name: fabric-private-networking-sample

requiredVersions:
  azd: ">=1.15.0"

infra:
  provider: bicep
  path: infra
  module: main
  parameters: main.bicepparam

# This sample focuses on the Fabric networking steps only. It assumes the workspace
# already exists and its identifying values are present in the azd environment
# (for example, FABRIC_WORKSPACE_ID and FABRIC_WORKSPACE_NAME).
hooks:
  postprovision:
    # (Optional) Ensure the workspace capacity is active before attempting networking steps
    - shell: pwsh
      run: ./scripts/automationScripts/FabricWorkspace/CreateWorkspace/ensure_active_capacity.ps1
      interactive: false
      continueOnError: false

    # Step 1: Lock down the Fabric workspace so that only private endpoints are allowed
    - shell: pwsh
      run: ./scripts/automationScripts/FabricWorkspace/SecureWorkspace/enable_fabric_workspace_inbound_protection.ps1
      interactive: false
      continueOnError: false

    # (Optional) Assign the workspace to a Fabric domain if needed
    - shell: pwsh
      run: ./scripts/automationScripts/FabricWorkspace/CreateWorkspace/assign_workspace_to_domain.ps1
      interactive: false
      continueOnError: true

    # (Optional) Cleanup helper that can be invoked manually when test workspaces must be removed
    #   azd env set CLEANUP_TARGETS "workspace-dev123,workspace-dev456"
    #   pwsh ./scripts/automationScripts/cleanup/cleanup_orphaned_fabric_workspaces.ps1 -WorkspaceNames $env:CLEANUP_TARGETS.Split(',')
